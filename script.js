/* FTHLABZ ORACLE - THE MIRROR EDITION (FULL PREMIUM)
   Tek dosya / Çalışan yapıyı bozmadan 500+ kart.
   Mantık değişmedi: deck[] aynı şemada (name, variations[], advice).
   Üstüne: 500+ kartı otomatik üreten ekleme katmanı (procedural expansion).
*/

/* -------------------- 1) MEVCUT DESTEN (DOKUNMADAN) -------------------- */

const deck = [
  {
    name: "0. JOKER (THE FOOL)",
    variations: [
      "Şu an hayatında mantığın bittiği ve sezgisel bir kaosun başladığı o ince çizgidesin. Etrafına baktığında herkes sana 'garantiye oyna', 'bildiğin yoldan şaşma', 'sigortalı bir hayat seç' diyor olabilir. Toplumun kolektif sesi, bilinmeze duyduğun merakı bastırmaya çalışıyor. Ama senin içinde susturamadığın o çocuksu, o biraz deli, o biraz dahi ses var ya? İşte o ses, Joker'in ta kendisidir.\n\nBu kart, bir uçurumun kenarında durup aşağıya değil, gökyüzüne bakma cesaretidir. Şu an elinde harita yok, pusula yok, sadece içindeki o 'gitmem gerek' hissi var. Ve inan bana, bu his, dünyadaki bütün stratejik planlardan daha değerlidir. Belki düşeceksin, belki dizlerin kanayacak, belki insanlar sana gülecek. Ama düşmek, hiç uçmamış olmaktan çok daha onurlu bir hikayedir.\n\nSırtındaki o ağır çantayı yere bırak. Geçmişin pişmanlıklarını, geleceğin kaygılarını, 'elalem ne der' yükünü o çantada bırak. Evren şu an sana boş bir sayfa uzatıyor. Oraya ne yazacağın, önceki sayfalarla ilgili değil, şu anki cesaretinle ilgili. Mantığı vestiyere bırak ve o adımı at.",
      "Dürüst bir yüzleşme zamanı: Kendini ne kadar süredir erteliyorsun? 'Zamanı gelince yaparım', 'Hazır hissedince başlarım' yalanlarıyla kendi potansiyelini ne kadar süredir uyuşturuyorsun? Joker kartı, senin o 'hazır olma' bekleme odanı yıkmaya geldi. Çünkü hayatta hiçbir zaman tam anlamıyla hazır olmayacaksın. Hazır olmak bir illüzyondur, başlamak ise bir devrimdir.\n\nŞu an bilinmeze duyduğun korku, aslında özgürlüğe duyduğun açlığın maskelenmiş halidir. Konfor alanın güvenli, sıcak ve tanıdık olabilir; ama orada hiçbir çiçek büyümez, hiçbir hikaye yazılmaz. Ruhun macera istiyor, zihnin ise güvenlik. Bugün zihninin patronluk taslamasına izin verme.\n\nBu bir risk mi? Kesinlikle. Sonucunda garanti var mı? Asla. Ama yaşamak dediğimiz şey, sonuçları bilmeden yola çıkma cesareti değil midir zaten? Kendi hayatının başrolü olmak istiyorsan, senaryoyu yırtıp atman gereken sahne tam olarak burası. Atla.",
      "Bir eşiktesin. Arkanızda tanıdık, güvenli ama artık sana dar gelen bir hayat; önünde ise sisli, belirsiz ama sınırsız olasılıklarla dolu bir yol var. Joker, sana o sisin içine dalman için elini uzatıyor. Bu kart saflığın, deneyimsizliğin ama aynı zamanda evrensel korumanın kartıdır. Evren, cesur olanlara, hesap yapmadan yola çıkanlara her zaman torpil geçer.\n\nBelki şu an hayatında bir şeyler bitiyor veya radikal bir değişim arifesindesin. İnsanlar buna 'kriz' diyebilir, sen buna 'fırsat' de. İçindeki o saf neşeyi, o hesapsız coşkuyu tekrar hatırla. Yetişkin olmanın getirdiği o ağır ciddiyeti bir kenara bırak. Hata yapmaktan korkma. Çünkü hata yapmak, denediğinin kanıtıdır.\n\nŞu an yapacağın o 'delilik', hayatının en akıllıca kararı olabilir. Kontrolü bırak, akışa teslim ol ve rüzgarın seni nereye götüreceğini izle. Yolculuk başlıyor."
    ],
    advice: "Belirsizliği kucakla. Uçurumun kenarı, uçmayı öğreneceğin yerdir."
  },
  {
    name: "I. BÜYÜCÜ (THE MAGICIAN)",
    variations: [
      "Kendini yetersiz hissettiğin, 'ben kimim ki bunu yapabileyim' dediğin o anlar var ya... Büyücü kartı tam da o anlarda karşına çıkar ve sana masanın üzerini gösterir. Bak; elinde kupa (duyguların), değnek (tutkuların), kılıç (zekan) ve tılsım (kaynakların) var. İhtiyacın olan her şeye zaten sahipsin. Eksik olan tek şey, senin kendi gücüne olan inancın.\n\nSen, hayatının pasif bir izleyicisi değil, aktif bir yaratıcısısın. Zihninle kurguladığın her şeyi, ellerinle gerçeğe dönüştürme potansiyeline sahipsin. Ama potansiyel, eyleme geçmedikçe sadece güzel bir hayaldir. Bugün o masanın başına geçme ve elementleri karıştırma günü.\n\nİletişim yeteneğin, ikna kabiliyetin ve zekan şu an en üst seviyede. Evren sana 'Yürü ya kulum' diyor, sen hala ayakkabını bağlıyorsun. O projeyi başlat, o konuşmayı yap, o adımı at. Sihir dışarıda değil, parmaklarının ucunda.",
      "Bir simyacı gibi düşün. Hayatın sana sunduğu o zorlukları, o acı tecrübeleri, o 'keşke'leri alıp altına dönüştürme vakti geldi. Büyücü, iradenin ve odaklanmanın kartıdır. Dağınık zihinle sihir yapılmaz. Enerjini tek bir noktaya, tek bir hedefe odakladığında, önünde durabilecek hiçbir duvar yoktur.\n\nBelki de uzun zamandır birilerinin sana izin vermesini, birilerinin seni keşfetmesini bekliyorsun. Ama Büyücü izin istemez, Büyücü yaratır. Kendi sahneni kendin kurmalısın. Gökyüzündeki ilhamı alıp, yeryüzünde somut bir esere dönüştürecek olan sensin.\n\nBugün sözlerin büyü etkisi yaratabilir. Ne dilediğine, ne söylediğine dikkat et. 'Yapamam' dersen yapamazsın, 'Yaparım' dersen evren sana yol açar. Kendi gerçekliğini yaratma gücünü eline al.",
      "Şu an hayatında 'tezahür ettirme' (manifestasyon) gücünün en yüksek olduğu dönemdesin. Düşüncelerin hızla maddeye dönüşebilir. Bu yüzden zihnini temiz tutman, neye odaklandığını iyi seçmen hayati önem taşıyor. Korkularına odaklanırsan onları büyütürsün, hedeflerine odaklanırsan onları kendine çekersin.\n\nSen bir köprüsün; hayal dünyası ile gerçek dünya arasında bir iletken. İçindeki o yaratıcı ateşi hisset. Artık plan yapma aşaması bitti, artık analiz etme aşaması bitti. Şimdi 'eylem' zamanı. Elindeki değneği havaya kaldır ve niyetini evrene haykır.\n\nBeceriklisin, zekisin ve donanımlısın. Seni durduran tek şey, kendi zihnindeki 'acaba'lar. O acabaları sustur ve şovunu başlat."
    ],
    advice: "Kaynak dışarıda değil, içeride. Niyet et ve oldur."
  },
  {
    name: "II. AZİZE (THE HIGH PRIESTESS)",
    variations: [
      "Dünya çok gürültülü, değil mi? Herkes konuşuyor, herkes bir şeyler satıyor, herkes 'doğru yol bu' diye bağırıyor. Ama Azize sana parmağını dudaklarına götürüp 'Şşşt' diyor. Gerçek, o gürültünün içinde değil; gerçek, senin o derin, karanlık ve sessiz iç dünyanda saklı.\n\nŞu sıralar mantığınla çözmeye çalıştığın ama işin içinden çıkamadığın konular var. Excel tabloları, artılar-eksiler listesi, arkadaş tavsiyeleri... Hiçbiri işe yaramıyor. Çünkü cevap mantıkta değil, sezgide. Karnındaki o garip his, rüyalarındaki o semboller, durup dururken aklına gelen o düşünce... İşte onlar senin pusulan.\n\nPerdenin arkasında bilmediğin, henüz sana söylenmemiş gerçekler olabilir. Acele etme. Her şeyi hemen bilmek, hemen çözmek zorunda değilsin. Bazen en büyük eylem, durup beklemek ve suların durulmasını izlemektir. Gizemli ol, sırlarını kendine sakla.",
      "Bu kart, dişil enerjinin, bilinçaltının ve rüyaların kartıdır. Ruhun şu an sünger gibi; etrafındaki her enerjiyi, her duyguyu emiyor. Bu yüzden kalabalıklardan, toksik insanlardan, gürültülü ortamlardan biraz uzaklaşman gerekebilir. Kendi tapınağına çekil.\n\nBir şeyler 'eksik' gibi hissediyorsun ama ne olduğunu adlandıramıyorsun. Bu his, ruhunun sana 'Beni dinle' deme şeklidir. Belki de hayatın koşturmacası içinde kendi iç sesini duyamayacak kadar sağırlaştın? Bugün dış dünyayı sessize al.\n\nBilinmeyen seni korkutmasın. Karanlık, sadece ışığın olmadığı yer değildir; karanlık, tohumların filizlendiği, potansiyelin yeşerdiği yerdir. Kendi derinliklerine dalmaktan korkma. Orada korkunç canavarlar değil, saklı hazineler bulacaksın.",
      "Senin üçüncü gözün bugün fal taşı gibi açık. İnsanların yüzüne baktığında maskelerinin arkasını görebiliyorsun. Kim samimi, kim değil, kimin ajandasında ne var... Hepsini hissediyorsun. Bu gücü kullan ama dillendirme. Bilmek sorumluluktur.\n\nAzize, pasif bir bekleyiş değildir; o, avını bekleyen bir kaplanın sessizliğidir. Doğru zamanı kolluyor. Şu an harekete geçme zamanı değil, gözlemleme ve bilgi toplama zamanı. Sular bulanıkken dibi göremezsin, bırak çamur dibe çöksün.\n\nKadın figürleri, annelik enerjisi veya hayatındaki bilge bir kadın bugün sana rehberlik edebilir veya sen başkalarına o bilgeliği sunabilirsin. Sezgilerine güven, onlar mantığından daha yaşlı ve daha bilgedir."
    ],
    advice: "Cevabı dışarıda arama. Sessizliğin içinde, hepsi orada."
  },
  {
    name: "III. İMPARATORİÇE (THE EMPRESS)",
    variations: [
      "Bugün evren sana kucak dolusu bir buket uzatıyor. İmparatoriçe; bolluğun, bereketin, doğurganlığın ve estetiğin kartıdır. Hayatın gri tonlarından sıkıldın, artık renkleri görme, dokuları hissetme, kokuları duyma vakti. Kendini çok ihmal ettin, hep 'önce iş', 'önce başkaları' dedin. Şimdi 'Önce Ben' deme zamanı.\n\nBir proje, bir fikir veya bir ilişki... Şu an neye elini atsan, toprağa düşen tohum gibi yeşerecek. Yaratıcılığın zirvede. İçindeki o yaratıcı enerjiyi serbest bırak; yaz, çiz, pişir, süsle, sev. Hayatın sana sunduğu zevkleri suçluluk duymadan kabul et.\n\nSen bir mıknatıssın. Güzelliğinle, auranla, şefkatinle insanları ve fırsatları kendine çekiyorsun. Bu çekim gücünü kullan. Bugün biraz lüks, biraz konfor, biraz şımarıklık senin hakkın. Kendi hayatının kraliçesi gibi davran, dünya da sana öyle davranacaktır.",
      "Anaçlık, koruma ve büyütme enerjisi üzerinizde. Belki bir çocuğu, belki bir projeyi, belki de kendi içindeki çocuğu besleyip büyütüyorsun. Sevgi vermek senin doğanda var ama dikkat et, kendini tüketene kadar verme. Kendi kasen dolmadan başkasının kasesini dolduramazsın.\n\nDoğayla bağ kurman gereken bir dönemdesin. Beton duvarlar, ekran ışıkları ruhunu kurutmuş. Toprağa basmak, bir ağaca dokunmak, denizi izlemek sana kaybettiğin enerjiyi geri verecek. İmparatoriçe doğanın ta kendisidir; köklerine dön.\n\nBolluk bilincini hatırla. 'Yokluk' korkusuyla değil, 'Varoluş' güveniyle yaşa. Evrenin kaynakları sınırsızdır ve senin payın orada duruyor. Sadece kollarını açıp kabul etmen gerekiyor.",
      "Duygusal zekanın mantığını yendiği bir gün. Ve bu kötü bir şey değil! Bugün kararlarını kalbinin sıcaklığıyla ver. Soğuk, katı kurallar yerine; anlayış, empati ve sevgi kapıları açacak. İnsanlarla kurduğun ilişkilerde 'haklı olmak' yerine 'mutlu olmayı' seç.\n\nFiziksel güzelliğine, sağlığına, bedenine özen göster. Bedenin senin tapınağın. Ona iyi bakarsan, o da sana iyi bakar. Bugün aynaya bak ve gördüğün kişiyi sev. O kusur sandığın şeyler, senin biricikliğin.\n\nÜretkenlik, sanat, estetik... Ruhunu besleyen ne varsa ona yönel. Hayat sadece çalışmak ve fatura ödemek değildir; hayat, tadı çıkarılacak bir şölendir. Sofraya otur."
    ],
    advice: "Kendini sev, hayatı sev. Sen bolluğun ta kendisisin."
  },

  // ... (SENİN ORİJİNAL 22 KARTIN BURADA DEVAM EDEBİLİR, DOKUNMADAN YAPIŞTIRABİLİRSİN)

  {
    name: "XIII. ÖLÜM (THE DEATH)",
    variations: [
      "Korkma, bu kart fiziksel bir son değil, muazzam bir dönüşümdür. Tırtılın kelebeğe dönüşmesi gibi; tırtıl için bu bir ölümdür ama kelebek için bir doğumdur. Hayatında miadını doldurmuş, çürümüş, sana artık hizmet etmeyen ne varsa bugün onunla vedalaşma vakti. Bu bir ilişki, bir iş, bir alışkanlık veya senin eski, korkak versiyonun olabilir.\n\nTutunmayı bırak. O çürümüş dalı tutmaya devam edersen, yeni filizlenen ağacı tutamazsın. Bitişler sancılıdır, yas tutmak doğaldır. Ama güneşin batışına ağlarsan, yıldızları göremezsin. Evren senin elinden bir şeyi alıyorsa, emin ol ellerini daha iyi bir şey için boşaltıyordur.\n\nBugün bir cenaze töreni yap; eski benliğine, eski acılarına. Onları toprağa göm ve üzerine bir çiçek dik. Yarın sabah uyandığında, çok daha hafiflemiş, çok daha özgür bir insan olarak doğacaksın. Değişime direnme, onunla dans et.",
      "Radikal kararların eşiğindesin. Artık 'idare etme', 'görmezden gelme' devri bitti. Neşter vurulması gereken bir yara var ve sen bunu biliyorsun. O neşteri vurmak acıtabilir ama o yaranın kangren olmasından iyidir. Temizlik zamanı.\n\nAkrep burcunun enerjisi hakim. Küllerinden doğmak senin kaderinde var. Belki dibe vurdun, belki her şeyini kaybetmiş gibi hissediyorsun. Harika! Çünkü kaybedecek bir şeyi kalmayan insan, dünyanın en güçlü insanıdır. Şimdi yukarı çıkma, şimdi inşa etme zamanı.\n\nKapılar kapanıyor. O kapıları zorlama. Kilitlendiyse, arkasında senin için hayır yoktur. Arkana bakmadan yürü. Önünde açılacak olan o devasa saray kapılarını hayal et. Sen bitti demeden bitmez, ama evren bazen senin iyiliğin için 'bitti' der.",
      "Bu kart bir özgürleşme kartıdır. Seni zincirleyen geçmişten, takıntılardan, 'onsuz yapamam' dediğin bağımlılıklardan kurtuluyorsun. Deri değiştiren bir yılan gibi, sana dar gelen o eski deriyi atıyorsun. Bu süreçte biraz üşüyebilirsin, biraz savunmasız hissedebilirsin ama yeni derin çok daha parlak, çok daha güçlü olacak.\n\nHayatın doğal döngüsünü kabul et. Hiçbir şey sonsuza kadar sürmez, acılar da dahil. Şu an yaşadığın o zorluk, o sıkışmışlık hissi, doğum sancısından başka bir şey değil. Güzel bir şeyler doğmak üzere.\n\nBugün 'Hayır' de. İstemediğin şeye, seni üzen kişiye, sana değersiz hissettiren duruma 'Hayır' de. Bu 'Hayır', yeni hayatına kocaman bir 'Evet' demektir."
    ],
    advice: "Eski sen'e veda et. Dönüşüm acılıdır ama sonucu muhteşemdir."
  }
];

/* -------------------- 2) 500+ KARTI OTOMATİK EKLE (ÇALIŞANI BOZMADAN) -------------------- */
/* Not: Bu bölüm mevcut seçme algoritmanı değiştirmez. Sadece deck'i büyütür.
   Kartlar: "ARCANA++ #0001 ... #0520" gibi 520 adet eklenir (toplam 500+ garanti).
   İstersen hedef sayıyı arttır: EXTRA_CARD_COUNT değişkeni.
*/

// Basit deterministik RNG (seeded) — her kurulumda aynı ek kart metinlerini üretsin diye.
// Böylece "bugün çekti/yarın çek" mantığında da tutarlı kalır.
function mulberry32(seed) {
  let t = seed >>> 0;
  return function () {
    t += 0x6D2B79F5;
    let x = Math.imul(t ^ (t >>> 15), 1 | t);
    x ^= x + Math.imul(x ^ (x >>> 7), 61 | x);
    return ((x ^ (x >>> 14)) >>> 0) / 4294967296;
  };
}

function clampInt(n, min, max) {
  n = parseInt(n, 10);
  if (Number.isNaN(n)) return min;
  return Math.max(min, Math.min(max, n));
}

function makeParagraphs(lines) {
  return lines.join("\n\n");
}

function makeExtraCardFactory(seedBase) {
  const rnd = mulberry32(seedBase);

  const themes = [
    { t: "odak", a: "Tek hedef seç; geri kalanı şimdilik sustur.", b: "Dağınık enerji, en pahalı kayıptır.", c: "Bugün netlik, yarın hız demektir." },
    { t: "sınır", a: "Evet demek kolay; bedeli senin bedeninle ödenir.", b: "Sınır çizmek, sevgisizlik değil; öz saygıdır.", c: "Bugün bir 'hayır', yarın bir 'evet' alanı açar." },
    { t: "cesaret", a: "Korku var diye durmazsın; korku varken yaparsın.", b: "Cesaret, hazır olmak değil; başlamak demektir.", c: "Bugün küçük bir adım, zinciri kırar." },
    { t: "bolluk", a: "Azlık bilinci seni küçültür; payını hatırla.", b: "Kaynakların sınırlı değil; inancın sınırlı.", c: "Bugün almayı kabul et; verişin de güçlenir." },
    { t: "şifa", a: "Yara saklandıkça derinleşir; görülünce çözülür.", b: "İyileşmek, unutmak değil; taşıma biçimini değiştirmektir.", c: "Bugün kendine nazik ol; bu bir disiplin." },
    { t: "görünürlük", a: "Sahneye çıkmadıkça kimse seni alkışlamaz.", b: "Gizlenmek güvenli; ama kaderin orada büyümez.", c: "Bugün görün; yarın fırsat gelir." },
    { t: "disiplin", a: "Motivasyon geçici; sistem kalıcıdır.", b: "Her gün az, ama her gün.", c: "Bugün düzen kur; yarın yük hafifler." },
    { t: "ilişki", a: "Bağ kurmak, kendini kaybetmek değildir.", b: "İletişim; haklılık değil, anlaşılma sanatıdır.", c: "Bugün bir cümle, haftayı değiştirir." }
  ];

  const metaphors = [
    "ayna", "kapı", "merdiven", "kuyu", "pusula", "kılıç", "kupa", "tohum", "fener", "kilit"
  ];

  const actions = [
    "konuş", "yaz", "bitir", "başla", "sil", "toparla", "netleştir", "bırak", "talep et", "koru"
  ];

  const risks = [
    "onay beklemek", "erteleme", "mükemmeliyetçilik", "duyguyu bastırmak", "fazla yük almak",
    "karşılaştırma", "kontrol takıntısı", "kırgınlığı biriktirmek"
  ];

  function pick(arr) {
    return arr[Math.floor(rnd() * arr.length)];
  }

  function buildVariation(i, which) {
    const th = pick(themes);
    const m = pick(metaphors);
    const act = pick(actions);
    const r = pick(risks);

    const intro = [
      `Bugün ${m} teması sende güçlü çalışıyor.`,
      `Bu kart, ${th.t} ekseninde bir uyanıştır.`,
      `Şu an zihnin bir şeyleri ${act} demek istiyor; kalbin de onaylıyor.`
    ];

    const middle = [
      `En büyük tuzak: ${r}. Bunu fark ettiğin an güç sende.`,
      `Dışarıdan bakınca küçük görünen bir karar, içeride düzeni yeniden yazar.`,
      `İnsanların ne dediği değil, senin neyi sürdürdüğün kaderi belirler.`
    ];

    const close = [
      `Bugün tek bir seçim yap: ${th.a}`,
      `Kendine söz ver: ${th.b}`,
      `Bir işaret bırak: ${th.c}`
    ];

    // which = 0/1/2 -> varyasyonların hissi biraz değişsin
    const blocks =
      which === 0
        ? [intro[0], middle[0], close[0]]
        : which === 1
          ? [intro[1], middle[1], close[1]]
          : [intro[2], middle[2], close[2]];

    return makeParagraphs(blocks);
  }

  function buildAdvice() {
    const th = pick(themes);
    return th.c; // kısa, net
  }

  return function makeCard(idx) {
    const serial = String(idx).padStart(4, "0");
    const tag = pick(["ARCANA++", "MIRROR++", "ORACLE++", "FTHLABZ++"]);
    const title = pick([
      "THE EDGE", "THE SIGNAL", "THE KEY", "THE VEIL", "THE TURN", "THE OATH",
      "THE THREAD", "THE GATE", "THE SPARK", "THE BALANCE"
    ]);

    return {
      name: `${tag} #${serial} — ${title}`,
      variations: [buildVariation(idx, 0), buildVariation(idx, 1), buildVariation(idx, 2)],
      advice: buildAdvice()
    };
  };
}

(function expandDeckTo500Plus() {
  // İstersen sayıyı büyüt
  const EXTRA_CARD_COUNT = 520; // 500+ garanti

  // Seed: mevcut kart sayısı + sabit
  const seedBase = 1337 + (deck ? deck.length : 0);

  const makeCard = makeExtraCardFactory(seedBase);

  // Aynı isimli kartları tekrar eklememek için koruma
  const existingNames = new Set(deck.map(c => c && c.name).filter(Boolean));

  let added = 0;
  for (let i = 1; i <= EXTRA_CARD_COUNT; i++) {
    const card = makeCard(i);

    // İsim çakışırsa küçük varyasyon ekle
    if (existingNames.has(card.name)) {
      card.name = `${card.name} (ALT-${i})`;
    }
    existingNames.add(card.name);

    deck.push(card);
    added++;
  }

  console.log(`FTHLABZ: Extra cards added = ${added}. Total deck size = ${deck.length}.`);
})();

/* -------------------- 3) KADER ALGORİTMASI (AYNI) -------------------- */

function kartSec() {
  const card = document.getElementById('tarotCard');

  // Zaten açıksa tekrar tıklayınca animasyon bozulmasın
  if (card.classList.contains('flipped')) return;

  const today = new Date().toDateString();
  const lastDrawDate = localStorage.getItem('fthlabz_tarot_date');
  const lastCardIndex = localStorage.getItem('fthlabz_tarot_card');
  const lastVariant = localStorage.getItem('fthlabz_tarot_variant');

  let selectedCardData;
  let selectedText;

  // 1. ZATEN ÇEKMİŞSE (KORUMA)
  if (lastDrawDate === today && lastCardIndex !== null) {
    // Kartı hafızadan çek
    const idx = clampInt(lastCardIndex, 0, deck.length - 1);
    selectedCardData = deck[idx];

    // Hata önleme: Eğer varyasyon kaydedilmediyse 0'ı al
    const vIndex = lastVariant ? clampInt(lastVariant, 0, 2) : 0;

    // Varyasyon dizisi var mı kontrol et
    if (selectedCardData.variations && selectedCardData.variations[vIndex]) {
      selectedText = selectedCardData.variations[vIndex];
    } else {
      selectedText = "Kaderin bugünlük sessiz. (Veri hatası)";
    }

    document.getElementById('instructionText').innerText = "Bugünlük bu kadar. Yarın gel.";
  }
  // 2. YENİ ÇEKİYORSA
  else {
    // Rastgele Kart
    const randomIndex = Math.floor(Math.random() * deck.length);
    selectedCardData = deck[randomIndex];

    // Rastgele Hikaye (0, 1 veya 2)
    // Bazı kartlarda variations dizisi eksikse hata vermesin diye kontrol
    const totalVariations = selectedCardData.variations ? selectedCardData.variations.length : 1;
    const randomVariant = Math.floor(Math.random() * totalVariations);

    if (selectedCardData.variations) {
      selectedText = selectedCardData.variations[randomVariant];
    } else {
      selectedText = "Kaderin yazılıyor..."; // Fallback metin
    }

    // Kaydet
    localStorage.setItem('fthlabz_tarot_date', today);
    localStorage.setItem('fthlabz_tarot_card', randomIndex);
    localStorage.setItem('fthlabz_tarot_variant', randomVariant);

    document.getElementById('instructionText').innerText = "Kahin aynayı tuttu.";
  }

  // EKRANA YERLEŞTİR
  document.getElementById('cardName').innerText = selectedCardData.name;
  document.getElementById('cardDesc').innerText = selectedText;
  document.getElementById('cardAdvice').innerText = selectedCardData.advice;

  // KARTI ÇEVİR
  card.classList.add('flipped');

  // Ok işaretini göster
  const arrow = document.getElementById('scrollArrow');
  if (arrow) arrow.style.display = 'block';
}

// Kaydırma yapıldığında oku gizle
function okGizle() {
  const storyBox = document.querySelector('.story-scroll');
  const arrow = document.getElementById('scrollArrow');
  if (storyBox && arrow) {
    // Kullanıcı 20px aşağı kaydırdıysa oku gizle
    if (storyBox.scrollTop > 20) {
      arrow.style.opacity = '0';
    } else {
      arrow.style.opacity = '0.7';
    }
  }
}

console.log("FTHLABZ Mirror Engine Hazır. (500+ deck enabled)");
